<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .playfield {
            display: grid;
            grid-gap: 10px;
            grid-template-columns: repeat(3, 150px);
            grid-template-rows: repeat(3, 150px);
        }

        .field {
            background-color: lightblue;
            border: 2px solid black;
            text-align: center;
            font-size: 100px;
        }

        .field:hover {
            background-color: deepskyblue;
        }
    </style>
</head>
<body>
<button id="startGameButton" onclick="hideOrUnhide()">Start game</button>
<h1>
    Current player: <a id="player">X</a>
</h1>
<div id="fields" class="playfield">
    <div id="field1" class="field" onclick="writeText(this)">1</div>
    <div id="field2" class="field" onclick="writeText(this)">2</div>
    <div id="field3" class="field" onclick="writeText(this)">3</div>
    <div id="field4" class="field" onclick="writeText(this)">4</div>
    <div id="field5" class="field" onclick="writeText(this)">5</div>
    <div id="field6" class="field" onclick="writeText(this)">6</div>
    <div id="field7" class="field" onclick="writeText(this)">7</div>
    <div id="field8" class="field" onclick="writeText(this)">8</div>
    <div id="field9" class="field" onclick="writeText(this)">9</div>
</div>

<script>
    var turn = 0;

    function writeText(id) {
        turn += 1;

        const fieldsLeft = [];
        for (let i = 1; i <= 9; i++) {
            const id = "field" + i;
            if (!(document.getElementById(id).innerHTML === "X" || document.getElementById(id).innerHTML === "O")) {
                fieldsLeft.push(i);
            }
        }
        if (fieldsLeft.length === 0) {
            gameHasEnded();
        }
        var player = "X";
        var nextPlayer = "O";
        id.innerHTML = player;
        id.style.backgroundColor = "gray";
        document.getElementById("player").innerHTML = "O";
        const youHaveWon = gameWinner("X");
        if (youHaveWon) {
            if (confirm("YOU WON!")) {
                txt = "OK!";
                location.reload();
            }
        }
        // opponent's turn
        setTimeout(opponentTurn, 2000)
        turn += 1;
    }

    function opponentTurn() {
        const player = "O";
        const fieldsLeft = [];
        for (let i = 1; i <= 9; i++) {
            const id = "field" + i;
            if (!(document.getElementById(id).innerHTML === "X" || document.getElementById(id).innerHTML === "O")) {
                fieldsLeft.push(i);
            }
        }
        const choice = Math.floor(Math.random() * fieldsLeft.length)
        const fieldChosen = "field" + fieldsLeft[choice];
        document.getElementById(fieldChosen).style.backgroundColor = "gray";
        document.getElementById(fieldChosen).innerHTML = "O";
        var youHaveLost = gameWinner("O");
        if (youHaveLost) {
            if (confirm("YOU LOST!")) {
                txt = "OK!";
                location.reload();
            }
        }
        document.getElementById("player").innerHTML = "X";
    }

    function hideOrUnhide() {
        var el = document.getElementById("fields");
        if (el.style.display === "none") {
            el.style.display = "block"
        } else {
            el.style.display = "none";
        }
    }

    function gameWinner(player) {
        if (rowCheck("field1", "field2", "field3", player) ||
            rowCheck("field4", "field5", "field6", player) ||
            rowCheck("field7", "field8", "field9", player) ||
            rowCheck("field1", "field4", "field7", player) ||
            rowCheck("field2", "field5", "field8", player) ||
            rowCheck("field3", "field6", "field9", player) ||
            rowCheck("field1", "field5", "field9", player) ||
            rowCheck("field3", "field5", "field7", player)) {
            return true;
        }
    }

    function rowCheck(f1, f2, f3, player) {
        if (document.getElementById(f1).innerHTML === player &&
            document.getElementById(f2).innerHTML === player &&
            document.getElementById(f3).innerHTML === player) {
            //Make correct row green:
            const color = player === "X" ? "green" : "red";

            document.getElementById(f1).style.backgroundColor = color;
            document.getElementById(f2).style.backgroundColor = color;
            document.getElementById(f3).style.backgroundColor = color;
            return true;
        }
    }

    function gameHasEnded() {
        if (confirm("GAME HAS ENDED")) {
            txt = "START OVER!";
            location.reload();
        } else {
            txt = "Cancel!";
        }
    }

</script>
</body>
</html>
